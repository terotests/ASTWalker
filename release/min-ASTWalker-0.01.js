(function(){var t={},n=function(){!function(t){var n;t.ArrayExpression=function(t){var n=this;if(t.elements&&t.elements.length>0){var i={},e=[];t.elements.forEach(function(t){i[t.type]||(i[t.type]=[]),i[t.type].push(t),"number"==typeof t.value&&e.push(t.value)});var o,r=0;for(var s in i)o||(o=i[s]),r++;if(1==r){var a={};o.forEach(function(t){a[typeof t.value]=t});var u=Object.keys(a);if(1==u.length){var l=u[0];if("number"==l)return n.out("["),e.forEach(function(t,i){return i>0&&n.out(","),parseInt(t)==t?void n.out(t+".0"):void n.out(t)}),void n.out("]");if("string"==l)return void n.out(JSON.stringify(e))}}}console.error("So far object expressions are not allowed, - TODO: create hidden class for them")},t.AssignmentExpression=function(t,n){"="==t.operator&&(this.walk(t.left,n),this.out(" "+t.operator+" "),this.walk(t.right,n))},t.BinaryExpression=function(t,n){var i=["+","-","*","/","%","==","<",">",">=","<=","!="];return i.indexOf(t.operator)>=0?(this.walk(t.left,n),this.out(" "+t.operator+" "),void this.walk(t.right,n)):("=="==t.operator&&(this.walk(t.left,n),this.out(" == "),this.walk(t.right,n)),void("instanceof"==t.operator&&(this.walk(t.left,n),this.out(" is "),this.walk(t.right,n))))},t.BlockStatement=function(t,n){this.out("{",!0),this.indent(1),this.walk(t.body,n,!0),this.indent(-1),this.out("}")},t.CallExpression=function(t,n){if(t.callee){if(this.walk(t.callee,n),this.out("("),t.arguments){var i=this,e=0;t.arguments.forEach(function(t){e++>0&&i.out(", "),i.walk(t,n)})}this.out(")")}},t.createHiddenClass=function(t){var n=this._walkInfo.subCtxList[0],i=this._analyzer.collectObjectStructure(n,t);console.log("Tried to collect hidden class for "+t),console.log(i)},t.endBlock=function(){this.out("}",!0),this.indent(-1)},t.endCollecting=function(){this._collecting=!1},t.ExpressionStatement=function(t,n){this.walk(t.expression,n)},t.ForStatement=function(t,n){this.out("for "),t.init&&(this.walk(t.init,n),this.out("; ")),t.test&&(this.walk(t.test,n),this.out("; ")),t.update&&(this.walk(t.update,n),this.out("; ")),t.body&&this.walk(t.body,n),this.out("",!0)},t.FunctionDeclaration=function(t,n){if(!n)return void console.error("Context not defined!");if(!n.fnDecs||!n.fnDecs[t.id.name]){this.out("// TODO: Unknown function, define metadata somewhere...",!0),this.out("func "),this.out(t.id&&t.id.name?" "+t.id.name+" ":" UnknownFunction "),this.out(" -> "),this.out(" UnknownValue ");var i=this;this.out("(");var e=0;return t.params.forEach(function(t){e++>0&&i.out(","),i.walk(t,n)}),this.out(")"),void this.walk(t.body,n)}var o=n.fnDecs[t.id.name];this.out("func "),this.out(o.get("name")),this.out(" -> "),this.out(o.returns.get("t")+" ");var i=this;this.out("(");var e=0;o.params.forEach(function(t){e++>0&&i.out(", "),i.out(t.get("n")+":"+t.get("t"))}),this.out(")"),this.walk(t.body,n)},t.FunctionExpression=function(t,n){var i=0;t.params.forEach(function(t){i++>0&&e.out(","),e.walk(t,n)}),this.out(" -> "),this.out(" UnknownValue ");var e=this;this.out("("),this.out(")"),this.walk(t.body,n)},t.getStructures=function(){return this._structures},t.Identifier=function(t){this.out(t.name)},t.IfStatement=function(t,n){this.out("if("),this.walk(t.test,n),this.out(")"),t.consequent&&this.walk(t.consequent,n),t.alternate&&(this.out(" else "),this.walk(t.alternate,n)),this.out("",!0)},t.indent=function(t){this._indent+=t,this._indent<0&&(this._indent=0)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n,i,e){var o=AnalyzeFunc(),r=esprima.parse(t,{loc:!0,range:!0,comment:!0}),s=o.primaWalk(r,function(){return!0},function(){},{});this._analyzer=o,this._walkInfo=s,this._fnObj=n,this._structDefs=i,this._wCb=e,n&&(s.currentFn=n.get("name")),this._structures=[];var a={};a.fnDecs||(a.fnDecs={}),n&&(a.fnDecs[n.get("name")]=n),this._tabChar="  ",this._codeStr="",this._currentLine="",this._indent=0,this.walk(r,a,!0),this.out("",!0)}),t.Literal=function(t){this.out(t.raw)},t.MemberExpression=function(t){this.walk(t.object),this.out("."),this.walk(t.property)},t.NewExpression=function(t,n){if(t.callee){if(this.walk(t.callee),this.out("("),t.arguments){var i=this,e=0;t.arguments.forEach(function(t){e++>0&&i.out(", "),i.walk(t,n)})}this.out(")")}},t.nlIfNot=function(){this._currentLine.length>0&&this.out("",!0)},t.ObjectExpression=function(t){console.log("So far object expressions are not allowed, - TODO: create hidden class for them"),n||(n=1);var i=!0,e=this;try{var o={name:"TmpStructure"+n++,rawStr:"",varDefs:[]};console.log(t);var r="struct "+o.name+" { ";if(t&&t.properties?(console.log("-> trying to create "+o.name),t.properties.forEach(function(t){return"Property"==t.type&&t.key&&t.value&&t.value.raw?(o.varDefs.push({name:t.key.name,value:t.value.value,raw:t.value.raw}),void(r+="var "+t.key.name+" = "+t.value.raw+"\n")):(i=!1,void console.error("Object property not declared:",t))})):(console.log("Invalid properties node"),i=!1),r+="} \n",i&&(o.rawStr=r),i&&this.pushStructure(o),i){var e=this;e.out(o.name+"(");var s=0;o.varDefs.forEach(function(t){s++>0&&e.out(","),e.out(t.name+":"+t.raw)}),e.out(")")}}catch(a){console.error(a.message)}},t.out=function(t,n){if(this._collecting){if(t){if(0==this._collectLine.length)for(var i=0;i<this._indent;i++)this._collectLine+=this._tabChar;this._collectLine+=t}return void(n&&(this._collectStr+=this._collectLine+"\n",this._collectLine="",this._collectStr+="\n"))}if(t){if(0==this._currentLine.length)for(var i=0;i<this._indent;i++)this._currentLine+=this._tabChar;this._currentLine+=t}n&&(this._codeStr+=this._currentLine+"\n",this._currentLine="")},t.Program=function(t,n){this.walk(t.body,n,!0)},t.pushStructure=function(t){this._structures||(this._structures=[]),this._structures.push(t)},t.ReturnStatement=function(t,n){this.out("return "),this.walk(t.argument,n)},t.startBlock=function(){this.out("{",!0),this.indent(1)},t.startCollecting=function(){this._collecting=!0},t.ThisExpression=function(){this.out("self")},t.UnaryExpression=function(t,n){this.out(t.operator),this.walk(t.argument,n)},t.UpdateExpression=function(t,n){this.walk(t.argument,n),this.out(t.operator)},t.VariableDeclaration=function(t,n){var i=this,e=0;t.declarations.forEach(function(o){e++>0&&i.out("",!0),"var"==t.kind&&i.out("var "),"let"==t.kind&&i.out("let "),i.walk(o,n),e++})},t.VariableDeclarator=function(t,n){var i=this;i.out(t.id.name+" = "),i.walk(t.init,n)},t.walk=function(t,n,i){if(t instanceof Array){var e=this;t.forEach(function(t){e.walk(t,n),i&&e.nlIfNot()})}else t.type&&(this._wCb&&this._wCb(t),this[t.type]?this[t.type](t,n):(console.log("Did not find "+t.type),console.log(t)))},t.walkAsString=function(t,n){var i="";try{this.startCollecting(),this._collectStr="",this._collectLine="",this.walk(t,n),i=this._collectStr,this.endCollecting()}catch(e){}return i},t.WhileStatement=function(t,n){this.out("while "),t.test&&this.walk(t.test,n),t.body&&this.walk(t.body,n),this.out("",!0)}}(this)},i=function(t,n,e,o,r,s,a,u){var l,c=this;if(!(c instanceof i))return new i(t,n,e,o,r,s,a,u);var h=[t,n,e,o,r,s,a,u];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){l=t.apply(c,h)}),"function"==typeof l){if(l._classInfo.name!=i._classInfo.name)return new l(t,n,e,o,r,s,a,u)}else if(l)return l;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,h)}):"function"==typeof c.init&&c.init.apply(c,h)};i._classInfo={name:"ASTWalker"},i.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.ASTWalker=i,this.ASTWalker=i):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.ASTWalker=i:this.ASTWalker=i}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());